<%- include ('../admin/layouts/header.ejs')-%>

  <!-- partial -->
  <div class="main-panel">
    <div class="content-wrapper">
<!--       
      <div class="row">
        <div class="col-lg-6 grid-margin stretch-card">
          <div class="card">
            <div class="card-body">
              <h4 class="card-title">Area chart</h4>
              <canvas id="areaChart" style="height:250px"></canvas>
            </div>
          </div>
        </div>
        <div class="col-lg-6 grid-margin stretch-card">
          <div class="card">
            <div class="card-body">
              <h4 class="card-title">Bar chart</h4>
              <canvas id="barChart" style="height:230px"></canvas>
            </div>
          </div>
        </div>
      </div> -->
      <div class="row">

        <div class="col-lg-12  grid-margin stretch-card">

          <div class="card" style="overflow: auto; max-height: 800px;">
            <div class="card-body">
              <h4 class="card-title"> SHOZEY Sales Report</h4>
          <button id="download" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" >Report Download</button>   
           <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <form action="/admin/downloadreport" method="post">
                  <div class="form-group">
                    <label for="avtivationDate">Activation Date</label>
                    <input type="date" class="form-control" id="dateInput1" 
                      name="activationdate"  placeholder="activation date" style="color: white;" onchange="validateActivationDate(this)" required>
                    <p style="color: red;" id="expiryErr"></p>
                </div>
                <div class="form-group">
                  <label for="avtivationDate">Expiry Date</label>
                  <input type="date" class="form-control" id="dateInput2" 
                    name="expirydate"  placeholder="activation date" style="color: white;" onchange="validateDates(this)" required>
                  <p style="color: red;" id="activationErr"></p>
              </div>
              <button type="submit" id="sortButton" class="btn btn-primary mr-2">Submit</button>
            </form>
                </div>
               
              </div>
            </div>
          </div>  
           
           <div class="table-responsive" id="table">
                <table class="table">
                  <thead>
                    <tr>
                      <th>No.</th>
                      <th> Orderid</th>
                      <th>Products-Qty</th>
                      <th>Date</th>
                      <th>Customer</th>
                      <th>TotalAmount</th>
                    </tr>


                    <tr>
                      <% let count=1%>
                        <% for(let i=0 ;i<orderdata.length; i++){%>
                          <% let item=orderdata[i].items %>
                            <% let address=orderdata[i].deliveryDetails %>
                              <% for(let j=0;j<item.length;j++) {%>
                                <% let product=item[j].productid %>
                                  <td>
                                    <%= count++%>
                                  </td>
                                  <td>
                                    <%= orderdata[i]._id %>
                                  </td>
                                  <td>
                                    <%= item[j].count%>
                                  </td>
                                  <td>
                                    <%= orderdata[i].purchaseDate.toLocaleDateString('en-US', { year: 'numeric' ,
                                      month: 'short' , day: '2-digit' }).replace(/\//g, '-' ) %>
                                  </td>
                                  <td>
                                    <%= address.name %>
                                  </td>
                                  <td>
                                    <%= item[j].total %>
                                  </td>


                    </tr>
                    <%}%>
                      <%} %>



                  </thead>
                  <tbody>


                  </tbody>
                </table>
              </div>
            </div>

          </div>


        </div>
        <div class="container "
          style="max-width: 450px; margin: 0 auto; padding: 0; background-color: #000000; border: 0; border-radius: 5px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.2); text-align: right;">
          <form   action="/admin/salessort" method="post">
            <div style="display: inline-block;">
              <input type="date" name="datestart" id="dateInput1"
                style="width: 100%; padding: 3px; border: 1px solid #ccc; border-radius: 0; height: auto;">
            </div>
            <div style="display: inline-block;">
              <input type="date" name="dateend" id="dateInput2"
                style="width: 100%; padding: 3px; border: 1px solid #ccc; border-radius: 5px; height: auto;" onchange="validateDates(this)">
                <p style="color: red;" id="expiryErr"></p>

              </div>
            <button type="submit "  id="sortButton"
              style="background-color: #007BFF; color: #fff; border: none; border-radius: 5px; padding: 8px 15px; cursor: pointer;">
              Filter
            </button>
            <ul id="dateList" style="list-style: none; padding: 0;"></ul>
          </form>
        </div>


        
        <script>
         
         function validateDates(input) {
    var startDate = document.getElementById('dateInput1').value;
    var endDate = document.getElementById('dateInput2').value;

   
    if (endDate < startDate) {
        document.getElementById('expiryErr').innerText = 'End date cannot be earlier than the start date. Please select a valid date range.';
            document.getElementById('sortButton').disabled = true;
    }else{
        document.getElementById('expiryErr').innerText = '';
            document.getElementById('sortButton').disabled = false;
    }
  }
          
          var areaData = {
            labels: ["week7", "week6", "week5", "week4", "week3", "week2", "week1",],
            datasets: [{
              label: 'Week Chart',
              data: ["<%= week1%>","<%= week1%>", 0, 1, 2, 5, 7],
              backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)'
              ],
              borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)'
              ],
              borderWidth: 1,
              fill: true,
            }]
          };

          var areaOptions = {
            plugins: {
              filler: {
                propagate: true
              }
            },
            scales: {
              yAxes: [{
                gridLines: {
                  color: "rgba(204, 204, 204, 0.1)"
                }
              }],
              xAxes: [{
                gridLines: {
                  color: "rgba(204, 204, 204, 0.1)"
                }
              }]
            }
          };


          var areaChartCanvas = $("#areaChart").get(0).getContext("2d");
          var areaChart = new Chart(areaChartCanvas, {
            type: 'line',
            data: areaData,
            options: areaOptions
          }); F
          // }



          






          //         $(document).ready(() => {
          //   $('#formdata').on('submit', (event) => {
          //     event.preventDefault();
          //     var formData = $(this).serialize();  // Use formData instead of formdata

          //     $.ajax({
          //       url: '/admin/salessort',
          //       method: 'POST',  // Use POST instead of post
          //       data: formData,
          //       success: function(response) {
          //         if (response === true) {  // Use response instead of result
          //           $('#table').load('/admin/salessort #table');
          //         } else {
          //           console.log("Not found");
          //         }
          //       },
          //       error: function() {  // Handle AJAX error
          //         console.error("An error occurred.");
          //       }
          //     });
          //   });
          // });

          document.getElementById('formdata').addEventListener('submit', (e) => {
            e.preventDefault()
            console.log("hjgvf");
            const datestart = document.getElementById('dateInput1').value
            const dateend = document.getElementById('dateInput2').value
            console.log(datestart);
            console.log(dateend);
            $.ajax({
              url: "/admin/salessort",
              method: 'post',
              data: ({ date1: datestart, date2: dateend }),
              sucess: function (response) {
                if (res.true) {
                  console.log("data");
                } else {
                  console.log("notfound");
                }

              }
            })


          })

          
        </script>
        <script>
          ////////
          var data = {
            labels: ["NikeStructure25", "NikeAirMax97FuturaSE", "BATA","WoodlandMen's3513119AnkleBoot", "Versace", "BrunelloCucinelli"],
            datasets: [{
              label: 'Sold',
              data: [5,3,2,2,1,1],
              backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
              ],
              borderColor: [
                'rgba(255,99,132,1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
              ],
              borderWidth: 1,
              fill: false
            }]
          };

          var options = {
            scales: {
              yAxes: [{
                ticks: {
                  beginAtZero: true
                },
                gridLines: {
                  color: "rgba(204, 204, 204,0.1)"
                }
              }],
              xAxes: [{
                gridLines: {
                  color: "rgba(204, 204, 204,0.1)"
                }
              }]
            },
            legend: {
              display: false
            },
            elements: {
              point: {
                radius: 0
              }
            }
          };

          var barChartCanvas = $("#barChart").get(0).getContext("2d");
          // This will get the first returned node in the jQuery collection.
          var barChart = new Chart(barChartCanvas, {
            type: 'bar',
            data: data,
            options: options
          });
        </script>

        <%- include ('../admin/layouts/footer.ejs')-%>